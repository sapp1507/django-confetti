# Django Confetti üéâ

**Django Confetti** ‚Äî —ç—Ç–æ –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è Django, –≤–¥–æ—Ö–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π `REST_FRAMEWORK` –∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏ feature-flag —Å–∏—Å—Ç–µ–º.  
–û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å –∏ —Ö—Ä–∞–Ω–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ —É–¥–æ–±–Ω—ã–π API.

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîë **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫** (`SettingDefinition`) —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏, —Ç–∏–ø–∞–º–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.  
- üë§ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö override** (`SettingValue`): –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ –∏–ª–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
- ‚ö° **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Django signals.  
- üõ† **–ê–≤—Ç–æ—Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ `migrate` (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö).  
- üîÑ **–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:  
  - `confetti_seed` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `settings.CONFETTI`.  
  - `confetti_sync` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å —Ñ–ª–∞–≥–∞–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π.  
- üì¶ **API & Views**: –≥–æ—Ç–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ (DRF).  
- üìú **Swagger** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —á–µ—Ä–µ–∑ `drf-yasg`): –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫ API –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.  
- üß© **–ö–æ–Ω—Ñ–∏–≥ —á–µ—Ä–µ–∑ Django settings**: –∫–∞–∫ –≤ DRF (`CONFETTI = {...}`), —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `dotted path` –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π.  
- üöÄ **Fallback –±–µ–∑ DRF**: —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –Ω–µ—Ç DRF –∏–ª–∏ `drf-yasg`.

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
pip install django_confetti
```
–î–æ–±–∞–≤—å—Ç–µ –≤ INSTALLED_APPS:
``` python 
INSTALLED_APPS = [
    # ...
    "confetti",
]
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ ``settings.py``
```python
CONFETTI = {
    # –ö–∞—Å—Ç–æ–º–Ω—ã–π –º–µ—Ç–æ–¥ –æ—Ç–≤–µ—Ç–∞ (callable –∏–ª–∏ "pkg.mod:func")
    "RESPONSE_METHOD": "myproject.api.responses:api_response", # default rest_framework.response.Response or django.http.JsonResponse

    # –ê–≤—Ç–æ—Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
    "AUTO_SEED": True,

    "SEED_CATEGORIES": [
        {"code": "scheduler", "title": "–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫"},
        {"code": "notifications", "title": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"},
    ],

    "SEED_DEFINITIONS": [
        {
            "key": "feature.scheduler.enable_jobs",
            "type": "bool",
            "category": "scheduler",
            "title": "–í–∫–ª—é—á–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫",
            "default": True,
        },
        {
            "key": "job.cleanup.schedule",
            "type": "cron",
            "category": "scheduler",
            "title": "Cron –æ—á–∏—Å—Ç–∫–∏",
            "default": "0 3 * * *",
        },
        {
            "key": "notifications.email.enabled",
            "type": "bool",
            "category": "notifications",
            "title": "–ü–æ—á—Ç–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
            "default": True,
        },
    ],
}
```

## –ò—Å–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API
```python
from confetti.api import get, is_enabled, set_value
from confetti.conf import confetti_settings

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
jobs_enabled = is_enabled("feature.scheduler.enable_jobs")  # True / False

# –£—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ override
theme = get("ui.theme", user=request.user, default="light")

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è
set_value("ui.theme", "dark", user=request.user)

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (DRF Response –∏–ª–∏ JsonResponse)
return confetti_settings.RESPONSE_METHOD(data={"status": "ok"}, status=200)

```

## REST API
```python
# project/urls.py
urlpatterns = [
    # ...
    path("api/confetti/", include("confetti.urls", namespace="confetti")),
]
```

## –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
–î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

* ``GET /api/confetti/settings/``
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.

  * –ê–Ω–æ–Ω–∏–º: —Ç–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∏ default.
  * –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π: –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è ``user_value`` –∏ ``effective`` —É—á–∏—Ç—ã–≤–∞–µ—Ç override.

* ``GET /api/confetti/settings/<key>/``
–ü–æ–ª—É—á–∏—Ç—å –æ–¥–Ω—É –Ω–∞—Å—Ç—Ä–æ–π–∫—É.

    * ``PATCH /api/confetti/settings/<key>/``
–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É.

``scope="user"`` –∏–ª–∏ –±–µ–∑ ``scope``: —Å–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é).

``scope="global"``: –º–µ–Ω—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç ``is_staff/is_superuser``).

–£–¥–∞–ª—è—Ç—å –Ω–µ–ª—å–∑—è. –ß—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å ``default``, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å ``{"value": null}``.

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã
```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ (–Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
python manage.py confetti_seed

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å (–æ–±–Ω–æ–≤–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–æ–ª—è)
python manage.py confetti_sync --update

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å + –æ–±–Ω–æ–≤–∏—Ç—å default/choices/type
python manage.py confetti_sync --update --update-defaults

# –¢–æ–ª—å–∫–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è
python manage.py confetti_sync --dry-run

```

## Swagger (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å ``drf-yasg``, Confetti –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏.
–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–æ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –Ω–µ–≥–æ (–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ no-op).

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
```bash
pip install django_confetti[docs]
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
    
* SettingCategory ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏.

* SettingDefinition ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: –∫–ª—é—á, —Ç–∏–ø (bool, int, str, json, choice, cron, rrule, ‚Ä¶), –¥–µ—Ñ–æ–ª—Ç.

* SettingValue ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∏–ª–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

* –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: –∑–Ω–∞—á–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Django cache (confetti:v1:{key}:{user_id|global}), –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —Å–∏–≥–Ω–∞–ª–∞–º–∏.

* Seed/sync: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑ settings.CONFETTI.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Python 3.10+
* Django 3.2+
* (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Django REST Framework
* (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) drf-yasg
